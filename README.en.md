# Qt-App

-   [Simplified Chinese](README.md)
-   [English](README.en.md)

Picture resources etc. come from the Internet.
This code repository is for learning only. If it is used for commercial purposes by others, it has nothing to do with me! Please obey the license!

## Qt-App

-   A desktop application framework developed based on plug-ins, which can be used to quickly develop desktop applications;[qt-creator/src/libs/extensionsystem at master · qt-creator/qt-creator (github.com)](https://github.com/qt-creator/qt-creator/tree/master/src/libs/extensionsystem)；
-   Cooperate[vcpkg](https://github.com/microsoft/vcpkg)to use;
-   Support both[cmake](.github/workflows/cmake.yml)and[qmake](.github/workflows/qmake.yml)compile;
-   [Support Apple Silicon native compilation;](#问题和备注)
-   support[actions](.github/workflows/cmake.yml)Compile, package and publish;

<div align="center"><img src="doc/Qt-App.jpg" width="90%" height="90%" /></div>

## CrashReport

crash reporting program;

<div align="center"><img src="doc/CrashReport.jpg" width="50%" height="50%" /></div>

## Code structure

1.  [3rdparty](3rdparty): Third-party library;
    1.  [qtlockedfile](3rdparty/qtlockedfile):Qt file lock;
    2.  [qtsingleapplication](3rdparty/qtsingleapplication): Qt single instance;
    3.  [breakpad](3rdparty/breakpad.hpp): Crash capture based on Google Breakpad package;
2.  [aggregate](aggregate):polymerization;
3.  [apps](apps):app;
    1.  [app](apps/app)：Qt-App；
    2.  [crashreport](apps/crashreport)：CrashReport；
4.  [cmake](cmake): Encapsulated CMake utility function;
    1.  [utils](cmake/utils.cmake): Utility function;
5.  [core](core): Plug-ins are inherited here;
6.  [extensionsystem](extensionsystem): Plug-in system, the code comes from Qt-Creator, with some modifications;
7.  [gui](gui): Encapsulated interface component;
8.  [plugins](plugins):Plug-in;
    1.  [coreplugin](plugins/coreplugin): Core plug-in, main interface, menu, toolbar, status bar, settings, plug-in manager, etc.;
    2.  [hashplugin](plugins/hashplugin): Hash plug-in, the hash algorithm provided by QT;
    3.  [serialplugin](plugins/serialplugin): Serial plug-in;
    4.  [tcpplugin](plugins/tcpplugin): TCP plug-in;
9.  [resource](resource): Pictures and QSS files;
10. [utils](utils): Tool function encapsulation;

## Questions and comments

-   MacOS, the bundle generated by cmake is not generated in the .app/Contents/ folder`PkgInfo`document;
    1.  [app/CMakeLists](/apps/app/CMakeLists.txt), use this CMakeLists.txt to generate a bundle on MacOS, and the icon can be displayed normally, but there is no PkgInfo file;
    2.  How does cmake generate PkgInfo files?
        1.  WireShark use`set_source_files_properties(${CMAKE_CURRENT_SOURCE_DIR}/PkgInfo PROPERTIES MACOSX_PACKAGE_LOCATION .)`In a similar way, copy it to the bundle;
    3.  qmake will generate a PkgInfo file by default, you only need to specify`TARGET=app`or`CONFIG+=bundle`That’s it;

-   Under Unix systems, you need to use static libraries as much as possible to avoid dependence on dynamic libraries;
    1.  Several modules in this project are dynamic libraries, and because they are plugins, they need to be loaded dynamically;
    2.  Then you need to package these dynamic libraries and load them at runtime. You also need to modify the rpath`"-Wl,-rpath,\'\$$ORIGIN\':\'\$$ORIGIN/lib\':'\$$ORIGIN/../lib'")`, set it, otherwise the dynamic library will not be found;
    3.  Or use install_name_tool (macos), patchelf/chrpath (linux) to modify the dependency path of the dynamic library, which is very troublesome;
    4.  Also consider that these libraries can be shared, so do not package them repeatedly;
    5.  For details, please see[workflows](.github/workflows/cmake.yml)；

-   MacOS，[vcpkg](https://github.com/microsoft/vcpkg)Issues with compiling third-party libraries;
    1.  because[vcpkg](https://github.com/microsoft/vcpkg)at present[Only supports separate compilation of x64-osx and arm64-osx](https://github.com/microsoft/vcpkg/discussions/19454)；
    2.  In use[cmake](.github/workflows/cmake.yml), you need to specify`CMAKE_OSX_ARCHITECTURES=x86_64`or`CMAKE_OSX_ARCHITECTURES=arm64`;
    3.  In use[qmake](.github/workflows/qmake.yml), you need to specify`QMAKE_APPLE_DEVICE_ARCHS=x86_64`or`QMAKE_APPLE_DEVICE_ARCHS=arm64`；
